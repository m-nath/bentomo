if(!Prototype)throw('Event.Wrapper require prototype.js');if(Prototype.Browser.WebKit)(function(){Event._observe=Event.observe;function _search(hash,searchText){if(hash[searchText]){return(Object.isFunction(hash[searchText]))?hash[searchText]:Prototype.emptyFunction;}else{return(Object.isFunction(hash['_default']))?hash['_default']:Prototype.emptyFunction;}}
var firstUnload=true;Event.observe=function(element,name,func){return _search({'beforeunload':function(){return element.addEventListener('beforeunload',function(evt){return func.bind(element)(evt);});},'unload':function(){if(firstUnload)Event._observe(window,'unload',(function(){var cache={};var selector=$w('input option select textarea').join(':not(._marked),')+':not(.marked)';function storeCache(){$$(selector).each(function(e){cache[e.identify()]=e;e.addClassName('_marked');});}
Event._observe(document.body,'DOMNodeInserted',storeCache);Event._observe(window,'load',storeCache);return function(){var time=(new Date).getTime();$H(cache).each(function(e,i){e.value.name=time+"_"+i;});};})());firstUnload=false;return Event._observe(element,name,func);},'_default':function(){return Event._observe(element,name,func);}},name)();}
Object.extend(window,{observe:Event.observe.methodize()});})();if(!Prototype)throw('HTML.Template require prototype.js');if(1.6>Prototype.Version.split('.').slice(0,2).join('.')){throw(new Error('HTML.Template require prototype >= 1.6.0'));}
var HTML=HTML||{};HTML.Template=Class.create({_guessOption:function(option){if(Object.isString(option)){var pos=option.indexOf(':');if(pos>0&&pos<10){return{type:'name',source:option};}else{return{type:'text',source:option};}}
else if(Object.isFunction(option)){return{type:'function',source:option};}
else if(Object.isElement(option)){return{type:'element',source:option};}
if(!(option['type']&&option['source'])){throw('option needs {type:~~,source:~~}');}
return option;},_initUrl:function(source){this._source='contentUnload';if(this.option['element']&&(Object.isElement(this.option['element'])||this.option['element']===document)){this.assignElement=this.option['element'];}
this.storedName="url:"+source;if(this.isCompiled&&this.assignElement){var _self=this;(function(){_self.assignElement.fire('htmltemplate:compiled',_self);}).defer();return;}
new Ajax.Request(source,{method:'get',onSuccess:function(req){this._source=req.responseText;this.compile();this.isCompiled=true;if(this.assignElement){this.assignElement.fire('htmltemplate:compiled',this);}}.bind(this),onFailure:function(){if(this.assignElement){this.assignElement.fire('htmltemplate:failure',this);}else{throw(new Error('initUrl failed. can not load tmpl.'));}},onException:function(){if(this.assignElement){this.assignElement.fire('htmltemplate:invalid_tmpl',this);}else{throw(new Error('initUrl failed.  invalid tmpl.'));}}});},_initText:function(source){this._source=Object.isString(source)?source:(source.toString)?source.toString():'';this.compile();},_initFunction:function(source){if(Object.isFunction(source)){this._output=source;this.isCompiled=true;}else{throw(new Error('in case type is function, source must be function object.'));}},_initElement:function(source){var elem=$(source);if(Object.isElement(elem)&&!this.isCompiled){var tmpl=$A(elem.childNodes)
.select(function(m){return(m.nodeType==8);})
.map(function(m){return m.data;}).join('');this.storedName='dom:'+elem.identify();this._source=tmpl;this.compile();this.isCompiled=true;}},_initLoad:function(){if(!this.option['name'])throw('_initLoad need option.name');this._source=this.option['source'];this.storedName=this.option['name'];this.compile();this.isCompiled=true;},_initName:function(source){this.source='';this.storedName=source;if(HTML.Template.Cache[this.storedName]){this._output=HTML.Template.Cache[this.storedName];this.isCompiled=true;}
var segment=source.split(':');var _self=this;({dom:function(){var element=segment[1];_self._initElement(element);},url:function(){var url=segment[1];_self.option['element']=document;_self._initUrl(url);},autocache:function(){throw(new Error(' not in cache '));}})[segment[0]]();},initialize:function(option){this._param={};this._funcs={};this._chunks=[];this.isCompiled=false;this.isParsed=false;this.option=this._guessOption(option);var initializer=this['_init'+this.option['type'].capitalize()];if(initializer){initializer.apply(this,[this.option['source']]);}else{throw('initialize failed invalid initialize-type');}},_uniqHash:function(){return"autocache:"+HTML.Template.hashFunction(this.getSource());},registerFunction:function(name,func){this._funcs[name]=func;},functionize:function(){var _func=this._output;return function(param,functions){var _tmp=new HTML.Template({type:'function',source:_func});_tmp.param(param);_tmp._funcs=functions;return _tmp.output();};},render:function(targetNode,option){var tagName=(Object.isElement(targetNode))?targetNode.tagName:(Object.isString(targetNode))?targetNode:'div';if(document.createDocumentFragment){var dfrag=document.createDocumentFragment();Element._getContentFromAnonymousElement(tagName,this.output()).each(function(e){dfrag.appendChild(e);});this.toElement=function(){var tmp=dfrag.cloneNode(true);return tmp;};}
return null;},getSource:function(){return(Object.isFunction(this.option.filter)?this.option.filter:Prototype.K)(this._source);},clearParams:function(){this._param={};},clearFunctions:function(){this._funcs={};},clear:function(){this.clearParam();this.clearFunction();},param:function(obj){if(Object.isArray(obj)){throw('template.param not array');}
if(Object.isUndefined(obj)){return $H(this._param).keys();}
if(Object.isString(obj)){return this._param[obj];}
for(var prop in obj){this._param[prop]=obj[prop];}
return null;},parse:function(){var source=this.getSource();var chunks=[];var createElement=HTML.Template.createElement;this.root=createElement('ROOT',{closeTag:false});var matcher=(/ESCAPE=|DEFAULT=/.test(source))?HTML.Template.CHUNK_REGEXP_ATTRIBUTE:HTML.Template.CHUNK_REGEXP;chunks.push(this.root);while(source.length>0){var results=matcher(source);if(!results){chunks.push(createElement('TEXT',source));source='';break;}
var index=0;var fullText=results.fullText;if((index=source.indexOf(fullText))>0){var text=source.slice(0,index);chunks.push(createElement('TEXT',text));source=source.slice(index);};var attr,name,value;if(results.attribute_name){name=results.attribute_name.toLowerCase();value=results.attribute_value;attr={};attr[name]=value;attr['default']=results['default'];attr['escape']=results['escape'];}else{attr=undefined;}
chunks.push(createElement(results.tag_name,{'attributes':attr,'closeTag':results.close,'parent':this}));source=source.slice(fullText.length);};chunks.push(createElement('ROOT',{closeTag:true}));var l=chunks.length;var i=0;var codes=[];for(;i<l;i++){codes.push(chunks[i].getCode());};this._functionText=codes.join('\n');this.isParsed=true;this._chunks=chunks;return this;},compile:function(){if(!this.isCompiled){var uniq=this.storedName||this._uniqHash();if(HTML.Template.Cache[uniq]){this._output=HTML.Template.Cache[uniq];}else{var functionBody=this.parse()._functionText;try{this._output=Function(functionBody);}catch(e){throw(new Error("HTML_TEMPLATE_ERROR: "+uniq+" can't compile."));}
HTML.Template.Cache[uniq]=this._output;}
this.isCompiled=true;}},checkCompiled:function(){if(this.isCompiled)return true;if(this.type=='name'&&this.storedName){if(HTML.Template.Cache[this.storedName]){this._output=HTML.Template.Cache[this.storedName];this.isCompiled=true;return true;}}
return false;},query:function(type,arg){return this._chunks.select(function(e){}).map(function(e){});},output:function(){if(this.checkCompiled()){return this._output();}
return null;},toString:function(){return this.output()||'__UNCOMPILED__';},toHTML:function(){return this.output();}});HTML.Template.createMatcher=function(escapeChar,expArray){function _escape(regText){return(regText+'').replace(new RegExp(escapeChar,'g'),"\\");}
var count=0;var regValues=$A(expArray).inject({mapping:{'fullText':[0]},text:[]},function(val,e,i){if(Object.isString(e)){val.text.push(e);}else{if(!val.mapping[e.map]){val.mapping[e.map]=[];}
val.mapping[e.map].push(++count);}
return val;});var reg=undefined;regValues.text=_escape(regValues.text.join(''));return function matcher(matchingText){if(!reg){reg=new RegExp(regValues.text);}
var results=(matchingText||'').match(reg);if(results){var ret={};var prop=0,i=0,map=regValues.mapping;for(prop in map){var list=map[prop];var length=list.length;for(i=0;i<length;i++){if(results[list[i]]){ret[prop]=results[list[i]];break;}}}
return ret;}else{return undefined;}};};Object.extend(HTML.Template,{VERSION:'0.8',DEFAULT_SELECTOR:'.HTML_TEMPLATE',DEFERRED_SELECTOR:'.HTML_TEMPLATE_DEFERRED',CHUNK_REGEXP:HTML.Template.createMatcher('%',["<","(%/)?",{map:'close'},"TMPL_","(VAR|LOOP|IF|ELSE|ELSIF|UNLESS|INCLUDE)",{map:'tag_name'},"%s*","(?:","(NAME|EXPR)=",{map:'attribute_name'},"(?:","'([^'>]*)'|",{map:'attribute_value'},'"([^">]*)"|',{map:'attribute_value'},"([^%s=>]*)",{map:'attribute_value'},")",")?","%s*",">"]),CHUNK_REGEXP_ATTRIBUTE:HTML.Template.createMatcher('%',["<","(%/)?",{map:'close'},"TMPL_","(VAR|LOOP|IF|ELSE|ELSIF|UNLESS|INCLUDE)",{map:'tag_name'},"%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:'default'},'"([^">]*)"|',{map:'default'},"([^%s=>]*)",{map:'default'},")",")?","%s*","(?:","(?:ESCAPE)=","(?:","(JS|URL|HTML|0|1|NONE)",{map:'escape'},")",")?","%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:'default'},'"([^">]*)"|',{map:'default'},"([^%s=>]*)",{map:'default'},")",")?","%s*","(?:","(NAME|EXPR)=",{map:'attribute_name'},"(?:","'([^'>]*)'|",{map:'attribute_value'},'"([^">]*)"|',{map:'attribute_value'},"([^%s=>]*)",{map:'attribute_value'},")",")?",'%s*',"(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:'default'},'"([^">]*)"|',{map:'default'},"([^%s=>]*)",{map:'default'},")",")?","%s*","(?:","(?:ESCAPE)=","(?:","(JS|URL|HTML|0|1|NONE)",{map:'escape'},")",")?","%s*","(?:","(?:DEFAULT)=","(?:","'([^'>]*)'|",{map:'default'},'"([^">]*)"|',{map:'default'},"([^%s=>]*)",{map:'default'},")",")?","%s*",">"]),GLOBAL_FUNC:{__escapeHTML:function(str){return str.toString().escapeHTML();},__escapeJS:function(str){return Object.toJSON(str);},__escapeURL:function(str){return encodeURI(str);},__escapeNONE:function(str){return str;}},Cache:{STRING_FRAGMENT:[]},useLoopVariable:true,usePrerender:true,ElementCache:{},watchCache:function(min){var ret=[];var minimize=(min)?function(str){return str.replace(/(\n|^\s+)/mg,'');}:Prototype.K;ret.push('HTML.Template.Cache={');for(var prop in HTML.Template.Cache){var value=HTML.Template.Cache[prop];if(Object.isFunction(value)){ret.push("'"+prop+"':"+minimize(value.toString())+',');}
else{ret.push("'"+prop+"':"+Object.toJSON(value)+',');}}
ret.push('_fin_:undefined');ret.push('};');document.body.innerHTML+="<textarea style='width:100%;height:900px'>"+ret.join('')+"</textarea>";return ret.join('');},hashFunction:function(string){var max=(1<<31);var length=string.length;var ret=34351;var pos='x';for(var i=0;i<length;i++){var c=string.charCodeAt(i);ret*=37;pos^=c;ret+=c;ret%=max;}
return ret.toString(16)+'-'+(pos&0x00ff).toString(16);},createElement:function(type,option){return new HTML.Template[type+'Element'](option);},registerFunction:function(name,func){HTML.Template.GLOBAL_FUNC[name]=func;},precompileBySelector:function(selector){$$(selector).each(function(e){new HTML.Template({type:'element',source:e});});}});HTML.Template.Element=Class.create({initialize:function(option){if(this.type=='text'){this.value=option;}else{Object.extend(this,option);}
this['closeTag']=(this['closeTag'])?true:false;},isParent:Prototype.emptyFunction,execute:Prototype.emptyFunction,isClose:function(){return this['closeTag']?true:false;},inspect:function(){return Object.toJSON(this);},getCode:function(e){return"void(0);";},toString:function(){return['<',((this.closeTag)?'/':''),this.type,((this.hasName)?' NAME=':''),((this.name)?this.name:''),'>'].join('');},_pathLike:function(attribute,matched){var pos=(matched=='/')?'0':'$_C.length -'+(matched.split('..').length-1);return["(($_C["+pos+"]['",attribute,"']) ? $_C["+pos+"]['",attribute,"'] : undefined )"].join('');},getParam:function(){var ret="";if(this.attributes['name']){var matched=this.attributes['name'].match(/^(\/|(?:\.\.\/)+)(\w+)/);if(matched){return this._pathLike(matched[2],matched[1]);}
ret=["(($_T['",this.attributes['name'],"']) ? $_T['",this.attributes['name'],"'] : ",Object.toJSON(this.attributes['default'])||'undefined'," )"].join('');}
if(this.attributes['expr']){var operators={'gt':'>','lt':'<','eq':'==','ne':'!=','ge':'>=','le':'<='};var replaced=this.attributes['expr'].replace(/{(\/|(?:\.\.\/)+)(\w+)}/g,function(full,matched,param){return['$_C[',(matched=='/')?'0':'$_C.length -'+(matched.split('..').length-1),']["',param,'"]'].join('');}).replace(/\s+(gt|lt|eq|ne|ge|le|cmp)\s+/g,function(full,match){return" "+operators[match]+" ";});ret=["(function(){","    with($_GF){","        with($_SELF._funcs){","            with($_T){","                return (",replaced,');',"}}}}).apply($_SELF)"].join('');}
if(this.attributes['escape']){var escape={NONE:'NONE',0:'NONE',1:'HTML',HTML:'HTML',JS:'JS',URL:'URL'}[this.attributes['escape']];ret=['$_GF.__escape'+escape+'(',ret,')'].join('');}
return ret;}});Object.extend(HTML.Template,{ROOTElement:Class.create(HTML.Template.Element,{type:'root',getCode:function(){if(this.closeTag){return'return $_R.join("");';}else{return['var $_R  = [];','var $_C  = [this._param];','var $_GF = HTML.Template.GLOBAL_FUNC;','var $_T  = this._param;','var $_S  = HTML.Template.Cache.STRING_FRAGMENT;','var $_SELF = this;'].join('');}}}),LOOPElement:Class.create(HTML.Template.Element,{type:'loop',initialize:function($super,option){if(!this.constructor.instanceId){this.constructor.instanceId=0;}
this._ID=this.constructor.instanceId++;$super(option);},getCode:function(){if(this.closeTag){return['}','$_T = $_C.pop();'].join('');}else{var id=this._ID.toString(16);return['var $_L_'+id+' =$A('+this.getParam()+')|| [];','var $_LL_'+id+' = $_L_'+id+'.length;','$_C.push($_T);','for(var i_'+id+'=0;i_'+id+'<$_LL_'+id+';i_'+id+'++){','   $_T = (typeof $_L_'+id+'[i_'+id+'] == "object")?','                $_L_'+id+'[i_'+id+'] : {};',(HTML.Template.useLoopVariable)?["$_T['__first__'] = (i_"+id+" == 0) ? true: false;","$_T['__counter__'] = i_"+id+"+1;","$_T['__odd__']   = ((i_"+id+"+1)% 2) ? true: false;","$_T['__last__']  = (i_"+id+" == ($_LL_"+id+" - 1)) ? true: false;","$_T['__inner__'] = ($_T['__first__']||$_T['__last__'])?false:true;"].join(''):''].join('');}}}),VARElement:Class.create(HTML.Template.Element,{type:'var',getCode:function(){if(this.closeTag){throw(new Error('HTML.Template ParseError'));}else{return'$_R.push('+this.getParam()+');';}}}),IFElement:Class.create(HTML.Template.Element,{type:'if',getCondition:function(param){return"!!"+this.getParam(param);},getCode:function(){if(this.closeTag){return'}';}else{return'if('+this.getCondition()+'){';}}}),ELSEElement:Class.create(HTML.Template.Element,{type:'else',getCode:function(){if(this.closeTag){throw(new Error('HTML.Template ParseError'));}else{return'}else{';}}}),INCLUDEElement:Class.create(HTML.Template.Element,{type:'include',getCode:function(){if(this.closeTag){throw(new Error('HTML.Template ParseError'));}else{var name='"'+(this.attributes['name'])+'"';return['if(HTML.Template.Cache['+name+']){','   var _tmpl = new HTML.Template('+name+');','   _tmpl.registerFunction(this._funcs );','   _tmpl.param($_T);','   $_R.push(_tmpl.output());','}'].join('\n');}}}),TEXTElement:Class.create(HTML.Template.Element,{type:'text',closeTag:false,getCode:function(){if(this.closeTag){throw(new Error('HTML.Template ParseError'));}else{HTML.Template.Cache.STRING_FRAGMENT.push(this.value);return'$_R.push($_S['+(HTML.Template.Cache.STRING_FRAGMENT.length-1)+']);';}}})});HTML.Template.ELSIFElement=Class.create(HTML.Template.IFElement,{type:'elsif',getCode:function(){if(this.closeTag){throw(new Error('HTML.Template ParseError'));}else{return'}else if('+this.getCondition()+'){';}}});HTML.Template.UNLESSElement=Class.create(HTML.Template.IFElement,{type:'unless',getCondition:function(param){return"!"+this.getParam(param);}});if(HTML.Template.usePrerender){Object.extend(Object,{isDocumentFragment:function(object){return!!(object&&object.nodeType==11);},isElement:function(object){return!!(object&&(object.nodeType==1||object.nodeType==11));}});}
if(Object.isFunction(document.observe))document.observe('dom:loaded',function(){HTML.Template.precompileBySelector(HTML.Template.DEFAULT_SELECTOR);HTML.Template.precompileBySelector.defer(HTML.Template.DEFERRED_SELECTOR);});Namespace('jp.co.mixi.lang.string').define(function(ns){var _isProcessable=function _isProcessable(text){return(typeof text==='string'||typeof text==='number');};var _deleteSessionUrl=function deleteSessionUrl(text){if(!_isProcessable(text)){return'';}
text=text.toString();var chars='[\\w\\-.?&,/=:%+~;#]*';return text.replace(new RegExp('(https?)://(m\\.)?(mixi\\.jp/)(\\w+)(\\.pl)\\?('+chars+')(ses=\\w+&?)('+chars+')','mg'),'$1://$2$3$4$5?$6$8');};var tuneHtml=function tuneHtml(text){if(!_isProcessable(text)){return'';}
text=text.toString();text=_deleteSessionUrl(text);return text
.replace(/</g,'&lt;')
.replace(/>/g,'&gt;')
.replace(/\n/g,'<br />')
.replace(/\{/g,'&#123;')
.replace(/\}/g,'&#125;')
.replace(/\+/g,'&#043;');};var tuneForm=function tuneForm(text){if(!_isProcessable(text)){return'';}
text=text.toString();return text
.replace(/</g,'&lt;')
.replace(/>/g,'&gt;')
.replace(/\{/g,'&#123;')
.replace(/\}/g,'&#125;')
.replace(/\+/g,'&#043;')
.replace(/'/g,'&#039;')
.replace(/"/g,'&quot;');};var escapeHTML=function(text){if(!_isProcessable(text)){return'';}
text=text.toString();return text
.replace(/</g,'&lt;')
.replace(/>/g,'&gt;')
.replace(/\{/g,'&#123;')
.replace(/\}/g,'&#125;')
.replace(/\+/g,'&#043;')
.replace(/'/g,'&#039;')
.replace(/"/g,'&quot;');};var unescapeHTML=function(text){if(!_isProcessable(text)){return'';}
text=text.toString();return text.replace(/&lt;/g,'<')
.replace(/&gt;/g,'>')
.replace(/&#123;/g,'{')
.replace(/&#125;/g,'}')
.replace(/&#043;/g,'+')
.replace(/&#039;/g,"'")
.replace(/&quot;/g,'"');};var lineFeedToBreak=function(text){if(!_isProcessable(text)){return'';}
text=text.toString();return text.replace(/\n/g,'<br />');};var tuneTextarea=function tuneTextarea(text){if(!_isProcessable(text)){return'';}
text=text.toString();return text
.replace(/</g,'&lt;')
.replace(/>/g,'&gt;')
.replace(/\{/g,'&#123;')
.replace(/\}/g,'&#125;')
.replace(/\+/g,'&#043;');};var _padTo2Digit=function(num){if(num<10){return'0'+num.toString();}
return num.toString();};var formatTime=function formatTime(timestamp){var dateObj=new Date(timestamp);return _padTo2Digit(dateObj.getHours())+':'+_padTo2Digit(dateObj.getMinutes());};var formatDate=function formatDate(timestamp){var dateObj=new Date(timestamp);return(dateObj.getMonth()+1)+'\u6708'+(dateObj.getDate())+'\u65E5';};var formatDatetime=function formatDatetime(timestamp,enableLeadingZero){var dateObj=new Date();dateObj.setTime(timestamp);var dateStr=dateObj.getFullYear()+"\u5E74";dateStr+=(enableLeadingZero?_padTo2Digit(dateObj.getMonth()+1):(dateObj.getMonth()+1))+"\u6708";dateStr+=(enableLeadingZero?_padTo2Digit(dateObj.getDate()):dateObj.getDate())+"\u65E5";dateStr+=" "+formatTime(timestamp);return dateStr;};var formatElapsedTime=function(timestamp){var date=new Date(timestamp);var second=1000;var minute=second*60;var hour=minute*60;var day=hour*24;var elapsedTime=(new Date()).getTime()-date.getTime();if(elapsedTime>day){return _.string.sprintf("%02d\u6708%02d\u65E5",date.getMonth()+1,date.getDate());}else if(elapsedTime>hour){return _.string.sprintf("%d\u6642\u9593\u524D",elapsedTime/hour);}else if(elapsedTime>minute){return _.string.sprintf("%d\u5206\u524D",elapsedTime/minute);}else if(elapsedTime>second){return _.string.sprintf("%d\u79D2\u524D",elapsedTime/second);}else{return"0\u79D2\u524D";}};var formatCalendarDate=function(timestamp){if(!timestamp){return null;}
var WEEK_LABELS=["\u65E5","\u6708","\u706B","\u6C34","\u6728","\u91D1","\u571F"];var date=new Date();date.setTime(timestamp);return(date.getMonth()+1)+'/'+(date.getDate())+'('+WEEK_LABELS[date.getDay()]+')';};var foldText=function foldText(text,length,suffix){if(arguments.length===4){text=arguments[0];length=arguments[1];suffix=arguments[3];}
if(length<=0)return text;if((Object.prototype.toString.call(text)==="[object Number]"))text=text.toString();if(!(Object.prototype.toString.call(text)==="[object String]"))return'';if(text.length==0)return'';var byteLength=length*2;var escapedString=escape(text);var escapedStringLength=escapedString.length;var innerSuffix=suffix||'\u2026';var escapedIndex=0;var unicodeIndex=0;var byteTotal=0;var resultChars=[];while(escapedIndex<escapedStringLength&&byteTotal<byteLength){if(escapedString.charAt(escapedIndex)=='%'){if(escapedString.charAt(escapedIndex+1)=='u'){byteTotal+=2;escapedIndex+=6;}else{byteTotal++;escapedIndex+=3;}}else{byteTotal++;escapedIndex++;}
resultChars.push(text.charAt(unicodeIndex++));}
var result=resultChars.join('')
+(escapedIndex<escapedStringLength?innerSuffix:'');return result;};var snipText=function snipText(text,length,encoding){return foldText(text,length,'...');};var breakUrl=function breakUrl(url){if(!_isProcessable(url)){return'';}
url=url.toString();for(var i=0,wrappedURL='';i<url.length;i++){wrappedURL+=url.charAt(i);if(i<url.length-1&&((i+1)%7)==0){wrappedURL+='<wbr/>';}}
return wrappedURL;};var isBlank=function(text){return/^(\s|\u3000)*$/.test(text);};var countByteLength=function(text,multibyteCharLength){multibyteCharLength=multibyteCharLength||2;if(!_.isString(text)){return 0;}
var characters=text.split('');var totalByte=0;_.each(characters,function(c){var isMultibyteChar=(escape(c).substring(0,2)=='%u');var charLength=(isMultibyteChar?multibyteCharLength:1);totalByte+=charLength;});return totalByte;};var isEmpty=function(string){var trim=/^[\s\xA0\u3000]+$/;return string.replace(trim,"").length?false:true;};var toQueryParams=function(text,delimiter){var delimiterChar=delimiter?delimiter:'&';var arrayOfPair=text.replace(/^.*[?]/,'').replace(/#.*$/,'').split(delimiterChar);if(!arrayOfPair[0]){return{};}
var hashOfArray={};var createHash=function(e){var keyValue=e.split('=');var key=keyValue[0];var value=keyValue[1];if(keyValue[1]!==undefined){value=decodeURIComponent(value);}
if(hashOfArray[key]){if(_.isArray(hashOfArray[key])){hashOfArray[key].push(value);}else{hashOfArray[key]=[hashOfArray[key],value];}}else{hashOfArray[key]=value;}};var length=arrayOfPair.length;for(var i=0;i<length;i++){createHash(arrayOfPair[i]);}
return hashOfArray;};var createUrl=function createUrl(){var args=_.toArray(arguments);if(args.length===0){return'';}
var path=(args.shift()||'').split('#');var paramList;if(args.length===1&&_.isArray(args[0])){paramList=args[0].slice();}else if(args.length===1&&_.isObject(args[0])){paramList=[];_.each(args[0],function(value,key){paramList.push(key,value);});}else if(args.length>0&&args.length%2===0){paramList=args;}else{return path.join('#');}
var encodedParamList=_.map(paramList,function(value){if(value===null||value===undefined)return'';return encodeURIComponent(value);});var pairs=[];var pair;while(!_.isEmpty(pair=encodedParamList.splice(0,2))){if(pair[0].length===0)continue;pairs.push(pair.join('='));}
if(_.isEmpty(pairs))return path.join('#');if(!_.str.include(path[0],'?')){path[0]=path[0]+'?';}
else if(!_.str.endsWith(path[0],'?')&&!_.str.endsWith(path[0],'&')){path[0]=path[0]+'&';}
path[0]=path[0]+pairs.join('&');return path.join('#');};ns.provide({escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,lineFeedToBreak:lineFeedToBreak,tuneHtml:tuneHtml,tuneTextarea:tuneTextarea,tuneForm:tuneForm,foldText:foldText,snipText:snipText,breakUrl:breakUrl,formatTime:formatTime,formatDate:formatDate,formatDatetime:formatDatetime,formatElapsedTime:formatElapsedTime,formatCalendarDate:formatCalendarDate,isBlank:isBlank,countByteLength:countByteLength,isEmpty:isEmpty,toQueryParams:toQueryParams,createUrl:createUrl});});Namespace('lib.html.register_html_escape')
.use('jp.co.mixi.lang.string createUrl, escapeHTML')
.apply(function(ns){HTML.Template.registerFunction('create_url',ns.createUrl);HTML.Template.registerFunction('html_escape',ns.escapeHTML);});;(function(){var emptyFunction=function(){};('create_help_item_url create_help_category_url '
+'create_mixi_url create_photo_mixi_url create_news_mixi_url')
.split(/\s/).forEach(function(name){HTML.Template.registerFunction(name,emptyFunction);});})();